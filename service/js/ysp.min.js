var YSP=function(){"use strict";return{}}(jQuery),YSP=function(u,e){"use strict";return u.youtube_player=null,u.options=null,u.api={init:function(t){u.options={player_id:t,youtube_subtitles:{},transcripts:{},keywords:{},languages:[],parsedLanguages:null,parsedTranscript:e.Deferred(),parsedKeywords:e.Deferred()},u.youtube_player=document.getElementById(t),u.options.video_id=u.parser.getVideoId(),u.youtube_player||u.options.video_id||console.log("Player Id was wrong!"),u.api.getSubtitles()},getSubtitles:function(){u.parser.getLangs()},getLanguages:function(e){u.options.parsedLanguages.done(function(){e&&e({languages:u.options.languages})})},getTranscript:function(e){u.options.parsedTranscript.done(function(){e&&e({transcripts:u.options.transcripts})})},getKeywords:function(e){u.options.parsedKeywords.done(function(){e&&e({keywords:u.options.keywords})})}},u}(YSP,jQuery),YspCommon=function(){"use strict";var u=function(u){for(var t=[],r=u.transcript,n=0;n<r.length;n++){var s=r[n];if(s){var o=e(s.w,"").toLowerCase().trim();if(""!==o){for(var a=new Fuse(r,{keys:["w"],threshold:0}),i=a.search(o),F=[],p=0;p<i.length;p++){var l=i[p];l.w&&l.w.length<=o.length+2&&(F.push(l.s/1e3),r[l.p-1].w="")}var c={name:o,internalName:[o],t:{unknown:F}};t.push(c)}}}return{categories:{},keywords:t,requestStatus:"SUCCESS",transcriptType:"machine"}},e=function(u){return u.replace(/[\$\uFFE5\^\+=`~<>{}\[\]|\u3000-\u303F!-#%-\x2A,-:;\x3F@\x5B-\x5D_\x7B}\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/g,"")};return{parseKeywords:u,replacePunctuation:e}}(),YSP=function(u,e){"use strict";return u.parser={getLangs:function(){u.options.parsedLanguages=e.ajax({type:"POST",url:"http://www.youtube.com/api/timedtext?v="+u.options.video_id+"&expire=1&type=list",dataType:"xml",success:function(t){for(var r=t.documentElement,n=e(r).find("track"),s=[],o=0;o<n.length;o++){var a=n[o],i=e(a).attr("lang_code"),F=e(a).attr("lang_translated");if(i){var p={};p[i]=F,u.options.languages.push(p);var l=u.parser.getSubtitlesByLang(i);s.push(l)}}e.when.apply(u,s).then(u.parser.parseSubtitle)},error:function(u,e,t){console.log(t+": Error "+u.status)}})},getSubtitlesByLang:function(t){return e.ajax({type:"POST",url:"http://www.youtube.com/api/timedtext?v="+u.options.video_id+"&lang="+t,success:function(e){u.options.youtube_subtitles[t]=e.documentElement},error:function(u,e,t){console.log(t+": Error "+u.status)}})},parseTranscript:function(u){var t=[];return e(u).find("text").each(function(){var u=e(this),r=u.text(),n=r.split(/(?=\W)(?=\s)/),s=u.attr("start");s=s?1e3*s:0;var o=u.attr("dur");o=o?1e3*o:0;for(var a=s+o,i=0;i<n.length;i++){var F=n[i].trim(),p={w:F,s:s,e:a,p:t.length+1};t.push(p)}}),{transcript:{transcript:t,transcriptType:"machine",fileStatus:"MACHINECOMPLETE",requestStatus:"SUCCESS"}}},startWorkerKeywordParser:function(e){console.time("keywords_workers");var t=0,r=[],n=function(e){t--,u.options.keywords[e.data.lang]=e.data.response,0===t&&(console.timeEnd("keywords_workers"),u.options.parsedKeywords.resolve())};for(var s in e)e.hasOwnProperty(s)&&(r[t]=new Worker("js/subtitles/parserWorker.js"),r[t].onerror=function(u){console.log(["ERROR: Line ",u.lineno," in ",u.filename,": ",u.message].join(""))},r[t].onmessage=n,r[t].postMessage({transcript:e[s],lang:s}),t++)},parseSubtitle:function(){console.time("parseSubtitle");var e=u.options.youtube_subtitles;for(var t in e)if(e.hasOwnProperty(t)){var r=u.parser.parseTranscript(e[t]);u.options.transcripts[t]=r.transcript,window.Worker||(u.options.keywords[t]=YspCommon.parseKeywords(u.options.transcripts[t],t))}window.Worker?u.parser.startWorkerKeywordParser(u.options.transcripts):u.options.parsedKeywords.resolve(),u.options.parsedTranscript.resolve()},getVideoId:function(){var e=null;if(u.youtube_player&&u.youtube_player.getVideoUrl){var t=u.youtube_player.getVideoUrl();t=t.substring(t.indexOf("&v")+1),e=t.substring(t.indexOf("=")+1),-1!=e.indexOf("&")&&(e=e.substring(0,e.indexOf("&")))}else console.log("Youtube player is not ready!");return e}},u}(YSP,jQuery);